<!-- CSS -->
<link href="/branch/css/bootstrap.min.css" rel="stylesheet">
<link href="/branch/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/branch/css/animate.css" />
<link href="/branch/css/style.css" rel="stylesheet">
<link href="/branch/css/icons.css" rel="stylesheet">
<!--form样式-->
<link rel="stylesheet" type="text/css" href="/branch/css/form.css" />
<!--自定义css-->
<link rel="stylesheet" type="text/css" href="/branch/css/styleCreate.css" />
<link rel="stylesheet" type="text/css" href="/branch/css/customStyles.css" />
<!--表单验证-->
<link rel="stylesheet" type="text/css" href="/branch/css/validator.css" />
<section class="content-header">
	<div class="block-area">
		<h3 class="block-title">订单搜索</h3>
	</div>

	<div class="row">
		<div class="col-xs-12">
			<table class="table table-striped">
				<tbody id="orderSearchTaboy">
					<tr>
						<td>
							<div class="input-group">
								<span class="input-group-addon span_addon">订单号</span>
								<input type="text" name="orderNo" id="serOrderNo" class="input-sm input-text-height form-control" placeholder="订单号">
							</div>
						</td>
						<td>
							<div class="input-group">
								<span class="input-group-addon span_addon">套餐</span>
								<select name="examSuiteId" id="serExamSuiteId" class="suite form-control select">
								</select>
							</div>
						</td>
						<td>
							<div class="input-group">
								<span class="input-group-addon span_addon">体检人</span>
								<input type="text" name="customerPatientName" id="serCustomerPatientName" class="input-sm input-text-height form-control" placeholder="体检人">
							</div>
						</td>
						<td>
							<div class="input-group">
								<span class="input-group-addon span_addon">身份证号</span>
								<input type="text" namae="customerPatientIdCard" id="serCustomerPatientIdCard" class="input-sm input-text-height form-control" placeholder="身份证号">
							</div>
						</td>
					</tr>
					<tr class="odd-tr-sty">
						<td>
							<div class="input-group">
								<span class="laydate-icon input-group-addon span_addon padding_16"></span>
								<input type="text" name="startExamTime" class="input-sm input-text-height form-control" id="serStartExamTime" value="" placeholder="开始日期" />
							</div>
						</td>
						<td>
							<div class="input-group">
								<span class="laydate-icon input-group-addon span_addon padding_16"></span>
								<input type="text" name="endExamTime" class="input-sm input-text-height form-control" id="serEndExamTime" value="" placeholder="结束日期" />
							</div>
						</td>
						<td>
							<div class="input-group">
								<span class="input-group-addon span_addon">手机号码</span>
								<input type="text" name="customerPatientPhone" id="serCustomerPatientPhone" class="input-sm input-text-height form-control" placeholder="手机号码">
							</div>
						</td>

						<td>
							<div class="input-group">
								<input type="submit" class="btn span_addon font_16" id="orderListSer" value="搜索" />
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</section>
<!-- Main content -->
<section class="content">
	<div class="block-area">
		<h3 class="block-title">订单列表</h3>
	</div>
	<div class="row">
		<div class="col-xs-12">
			<table class="table table-striped">
				<thead>
					<tr>
						<th>操作</th>
						<th>订单号</th>
						<th>门店</th>
						<th>套餐</th>
						<th>体检人</th>
						<th>体检时间</th>
						<th>身份证号</th>
						<th>手机号</th>
						<th>创建时间</th>
						<th>订单状态</th>
					</tr>
				</thead>
				<tbody id="orderListTbody"></tbody>
			</table>
			<div class="row">
				<div class="col-xs-12 col-md-8" id="callBackPager"></div>
			</div>
		</div>
	</div>
</section>
<!--模态框查看-->
<!--<div class="modal fade" id="checkOrderList" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title">订单列表</h4>
			</div>
			<div class="modal-body">
				<form class="bs-example bs-example-form" role="form">
					<div class="input-group">
						<span class="input-group-addon">订单号</span>
						<input type="text" id="checkOrderNo" class="form-control" name="orderNo" aria-describedby="basic-addon1" disabled="disabled">
					</div>
					<div class="input-group">
						<span class="input-group-addon">门店名称</span>
						<select class="form-control selectpicker brands" id="checkBranchId" name="branchId" disabled="disabled">
						</select>
					</div>

					<div class="input-group">
						<span class="input-group-addon letter_spacing_30">套餐名称</span>
						<select class="form-control selectpicker suiteTypeId" id="checkExamSuiteIs" name="examSuiteIs" disabled="disabled">
						</select>
					</div>
					<div class="input-group">
						<span class="input-group-addon">体检人</span>
						<input type="text" id="checkCustomerInfoName" class="form-control" name="customerInfoName" aria-describedby="basic-addon1" disabled="disabled">
					</div>
					<div class="input-group">
						<span class="input-group-addon">体检时间</span>
						<input type="text" id="checkExamTime" class="form-control" name="examTime" aria-describedby="basic-addon1" disabled="disabled">
					</div>
					<div class="input-group">
						<span class="input-group-addon letter_spacing_30">身份证号</span>
						<input type="text" id="checkPatientIdCartNo" class="form-control" name="patientIdCardNo" aria-describedby="basic-addon1" disabled="disabled">
					</div>
					<div class="input-group">
						<span class="input-group-addon">手机号</span>
						<input type="text" id="checkPositionPhone" class="form-control" name="positionPhone" aria-describedby="basic-addon1" disabled="disabled">
					</div>
					<div class="input-group">
						<span class="input-group-addon">创建时间</span>
						<input type="text" id="checkCustomerOrderCreateTime" class="form-control" name="customerOrderCreateTime" aria-describedby="basic-addon1" disabled="disabled">
					</div>
					<div class="input-group" id='checkPatientStatus'>
						<span class="input-group-addon">订单状 态</span>
						<input type="radio" name='patientStatus' value="0" class="userlist_userStatusinput_vertical" disabled="disabled" />已支付
						<input type="radio" name='patientStatus' value="1" class="userlist_userStatusinput_vertical" disabled="disabled" />未支付
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
			</div>
		</div>
	</div>
</div>-->

<!--地址-->
<script src="/branch/js/createJs/pageUrl.js"></script>
<script src="/branch/js/jquery.min.js"></script>
<!--分页插件-->
<script src="/branch/js/plugins/extendPagination.js"></script>
<!--select样式-->
<script src="/branch/js/plugins/select.min.js"></script>
<!--日历插件-->
<script src="/branch/laydate/laydate.js"></script>
<script src="/branch/js/createJs/content.js"></script>
<!--表单验证-->
<script src="/branch/js/plugins/formValidator-4.0.1.min.js"></script>
<script src="/branch/js/plugins/formValidatorRegex.js"></script>
<script type="text/javascript">
	//日历控件皮肤
	! function() {
		laydate.skin('yahui'); //切换皮肤，请查看skins下面皮肤库
		laydate({
			elem: 'input'
		}); //绑定元素
	}();
	//				//列表日期范围限制
	var start = {
		elem: '#serStartExamTime',
		format: 'YYYY-MM-DD hh:mm:ss',
		istime: true,
		istoday: true,
		choose: function(datas) {
			end.min = datas; //开始日选好后，重置结束日的最小日期
			end.start = datas //将结束日的初始值设定为开始日
		}
	};
	var end = {
		elem: '#serEndExamTime',
		format: 'YYYY-MM-DD hh:mm:ss',
		max: '2099-06-16 23:59:59',
		istime: true,
		istoday: true,
		choose: function(datas) {
			start.max = datas; //结束日选好后，充值开始日的最大日期
		}
	};
	laydate(start);
	laydate(end);
	allSuites();
	//套餐下拉框
	function allSuites() {
		var otype = "post";
		var osync = false;
		var reqResult = httpRequest(getAllSuiteUrl, null, otype, osync);
		if(reqResult.result == 0) {
			var datal = reqResult.data;
			var html = "<option selected='selected' value=''>全部</option>";
			for(var i = 0; i < datal.length; i++) {
				html += "<option value= '" + datal[i].id + "'>" + datal[i].name + "</option>";
			}
			$(".suite").empty().append(html);
		} else {
			$(".suite").val('');
		}
	}

	//分页
	init_page();

	function init_page() {
		//1.请求后端信息并展示
		orderSearch();
		//2.初始化分页信息
		init_pager();
	}
	// 初始化分页信息
	function init_pager() {
		$('#callBackPager').extendPagination({
			totalCount: total_count,
			showCount: count_curr,
			limit: limit,
			callback: function(curr, limit, totalCount) {
				page_curr = curr;
				total_count = totalCount;
				orderSearch();
			}
		});
	}
	$('#orderListSer').on('click', function() {
		orderSearch();
		init_pager();
		return false;
	})

	function orderSearch() {
		$('#orderListTbody').empty();
		var orderNo = $("#serOrderNo").val();
		var branchId = $("#serBranchId").val();
		var examSuiteId = $("#serExamSuiteId").val();
		var customerPatientName = $("#serCustomerPatientName").val();
		var startExamTime = $("#serStartExamTime").val();
		var endExamTime = $("#serEndExamTime").val();
		var customerPatientPhone = $("#serCustomerPatientPhone").val();
		var customerPatientIdCard = $("#serCustomerPatientIdCard").val();
		var otype = "post";
		var osync = false;
		var param = {
			"page": page_curr,
			"rows": count_curr
		};
		if(orderNo) {
			param.orderNo = orderNo;
		}
		if(examSuiteId) {
			param.examSuiteId = examSuiteId;
		}
		if(customerPatientName) {
			param.customerPatientName = customerPatientName;
		}
		if(startExamTime) {
			param.startExamTime = startExamTime;
		}
		if(endExamTime) {
			param.endExamTime = endExamTime;
		}
		if(customerPatientPhone) {
			param.customerPatientPhone = customerPatientPhone;
		}
		if(customerPatientIdCard) {
			param.customerPatientIdCard = customerPatientIdCard;
		}
		var reqResult = httpRequest(getOrderListUrl, param, otype, osync);
		if(reqResult.result == 0) {
			total_count = reqResult.data.total;
			showOrderList(page_curr, limit, total_count, reqResult);
		}
		return false;
	}
	//展示列表
	function showOrderList(currPage, limit, total, dataBack) {
		$("#orderListTbody").empty();
		if(total - (currPage * limit) < 0) showNum = total - ((currPage - 1) * limit);
		var datal = dataBack.data.list;
		var str = '';
		for(var i = 0; i < datal.length; i++) {
			str += "<tr customerOrderId='" + datal[i].customerOrderId + "' orderNo='" + datal[i].orderNo + "'><td><a href='#checkOrderList' title='查看信息' data-toggle='modal' onclick='checkOrderList(this)'><i class='fa fa-eye'></i></a>";
			str += "<td>" + nullformat(datal[i].orderNo) + "</td>";
			str += "<td>" + nullformat(datal[i].branchName) + "</td>";
			str += "<td>" + nullformat(datal[i].examSuiteName) + "</td>";
			str += "<td>" + nullformat(datal[i].customerPatientName) + "</td>";
			str += "<td>" + nullformat(datal[i].examTime) + "</td>";
			str += "<td>" + nullformat(datal[i].customerPatientIdCard) + "</td>";
			str += "<td>" + nullformat(datal[i].customerPatientPhone) + "</td>";
			str += "<td>" + nullformat(getLocalTime(datal[i].customerOrderCreateTime)) + "</td>";
			if(datal[i].orderStatus==100){
				str += "<td>" + '已体检' + "</td>";
			} else if(datal[i].orderStatus>=50){
				str += "<td>" +' 正在体检<input class="org-order-btn" type="button" onclick="endExam(this)" value="结束体检"> '+ "</td>";
			}else if(datal[i].orderStatus>=40 && datal[i].orderStatus<50 ){
				str += "<td><input class='org-order-btn' type='button' onclick='startExam(this)' value='开始体检'></td>";
			}else if(datal[i].orderStatus<40){
				str += "<td>"+datal[i].customerOrderStatusName+"</td>";
			}
			str += "</tr>";
		}
		$("#orderListTbody").append(str);
		return false;
	}
	//开始体检
	function startExam(examStatus) {
		var orderNo = $(examStatus).parent().parent().attr("orderNo");
		var param = {
			"orderNo": orderNo
		};
		var otype = "post";
		var osync = false;
		var reqResult = httpRequest(startexaminationUrl, param, otype, osync);
		if(reqResult.data == 1) {
			$(examStatus).replaceWith("正在体检<input class='org-order-btn' type='button' onclick='endExam(this)' value='结束体检'>");
		} else {
			alert(reqResult.data);
		}
	}
	//结束体检
	function endExam(examStatus) {
		var orderNo = $(examStatus).parent().parent().attr("orderNo");
		var param = {
			"orderNo": orderNo
		};
		var otype = "post";
		var osync = false;
		var reqResult = httpRequest(examinationfinishUrl, param, otype, osync);
		if(reqResult.data == 1) {
			$(examStatus).parent().html("已体检");
		} else {
			alert(reqResult.data);
		}
	}
	//	查看回显信息
//		function checkOrderList(check) {
//			var checkOrderListId = $(check).parent().attr("customerOrderId");
//			var param = {
//				"customerOrderId": checkOrderListId
//			};
//			var otype = "get";
//			var osync = false;
//			var reqResult = httpRequest(getCustomerOrderUrl, param, otype, osync);
//			if(reqResult.result == 0) {
//				brands();
//				$('#checkOrderNo').val(reqResult.data.orderNo);
//				suiteTypeId();
//				$('#checkBranchId').val(reqResult.data.branchId);
//				$('#checkExamSuiteIs').val(reqResult.data.examSuiteIs);
//				$('#checkCustomerInfoName').val(reqResult.data.customerInfoName);
//				$('#checkExamTime').val(getLocalTime(reqResult.data.examTime));
//				$('#checkpatientIdCardNo').val(reqResult.data.patientIdCardNo);
//				$('#checkPositionPhone').val(reqResult.data.positionPhone);
//				$('#checkCustomerOrderCreateTime').val(getLocalTime(reqResult.data.customerOrderCreateTime));
//				if(reqResult.data.patientStatus <= 5) {
//					$('#checkPatientStatus input')[0].checked = "checked";
//				} else {
//					$('#checkPatientStatus input')[1].checked = "checked";
//				}
//			} else {
//				alert(reqResult.message);
//			}
//		}
</script>